<p>Moving along through our detailed <a href="https://airbrake.io/blog/nodejs-error-handling/nodejs-error-class-hierarchy"><strong>Node.js Error Handling</strong></a> series, today we’ll be going over the <strong>ERR_ENCODING_INVALID_ENCODED_DATA</strong> error, which is one of the many <code>System Errors</code> Node can generate. Node throws <code>System Errors</code> when an exception occurs within the application’s runtime environment, and such errors typically indicate that there was an operational problem within the program. An <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> error indicates that an invocation of the <a href="https://github.com/nodejs/node/blob/master/lib/internal/encoding.js#L355"><code>TextDecoder</code></a> failed because of incompatibility between the specified encoding and the decoding target.</p>
<p>In the rest of this article we’ll examine the <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> error by looking at where it sits in the larger <a href="https://airbrake.io/blog/nodejs-error-handling/nodejs-error-class-hierarchy">Node.js Error Class Hierarchy</a>. We’ll also explore some fully functional code samples that illustrate how the <code>TextDecoder</code> class can be used to handle <code>Buffer</code> decoding, and how incompatibilities can occasionally lead to <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> errors. Let’s do this!</p>
<h2 id="the-technical-rundown">The Technical Rundown</h2>
<p>Most Node.js errors inherit from the <a href="https://nodejs.org/api/errors.html#errors_class_error"><code>Error</code></a> base class, or extend from an inherited class therein. The full error hierarchy of this error is:</p>
<ul>
<li><a href="https://nodejs.org/api/errors.html#errors_class_error"><code>Error</code></a>
<ul>
<li><a href="https://nodejs.org/dist/latest-v8.x/docs/api/errors.html#errors_system_errors"><code>SystemError</code></a>
<ul>
<li><code>ERR_ENCODING_INVALID_ENCODED_DATA</code></li>
</ul></li>
</ul></li>
</ul>
<h2 id="full-code-sample">Full Code Sample</h2>
<p>Below is the full code sample we’ll be using in this article. It can be copied and pasted if you’d like to play with the code yourself and see how everything works.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">/**</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"> * index.js</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"> */</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">const</span> logging <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;logging&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">const</span> <span class="op">{</span> TextDecoder <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;util&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">function</span> <span class="at">executeTests</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  <span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`DECODE: Airbrake.io`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  <span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>(<span class="st">&#39;Airbrake.io&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  <span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`DECODE: Âirbrake.io`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>(<span class="st">&#39;Âirbrake.io&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`DECODE: [0xc3, 0x82, 0x69, 0x72, 0x62, 0x72, 0x61, 0x6b, 0x65, 0x2e, 0x69, 0x6f]`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  <span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>([<span class="bn">0xc3</span><span class="op">,</span> <span class="bn">0x82</span><span class="op">,</span> <span class="bn">0x69</span><span class="op">,</span> <span class="bn">0x72</span><span class="op">,</span> <span class="bn">0x62</span><span class="op">,</span> <span class="bn">0x72</span><span class="op">,</span> <span class="bn">0x61</span><span class="op">,</span> <span class="bn">0x6b</span><span class="op">,</span> <span class="bn">0x65</span><span class="op">,</span> <span class="bn">0x2e</span><span class="op">,</span> <span class="bn">0x69</span><span class="op">,</span> <span class="bn">0x6f</span>]))<span class="op">;</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">  <span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`NON-FATALLY DECODE: Âirbrake.io`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  <span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>(<span class="st">&#39;Âirbrake.io&#39;</span>)<span class="op">,</span> <span class="st">&#39;utf-8&#39;</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="op">}</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">/**</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co"> * Decodes passed Buffer via TextDecoder, using passed encoding and fatal option.</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co"> * Iterates and outputs each byte segment of full buffer.</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co"> *</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">buffer</span><span class="co"> Buffer to be decoded.</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">encoding</span><span class="co"> Encoding to use.</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">fatal</span><span class="co"> Determines if decoder will throw errors if an issue occurs.</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co"> */</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="kw">function</span> <span class="at">decodeBuffer</span> (buffer<span class="op">,</span> encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span><span class="op">,</span> fatal<span class="op">=</span><span class="kw">true</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    <span class="co">// Create text decoder with proper encoding and fatal option.</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32">    <span class="kw">const</span> decoder <span class="op">=</span> <span class="kw">new</span> <span class="at">TextDecoder</span>(encoding<span class="op">,</span> <span class="op">{</span> <span class="dt">fatal</span><span class="op">:</span> fatal <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    <span class="co">// Iterate through buffer, slicing from start to each index, then outputting and decoding.</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="va">buffer</span>.<span class="at">length</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">--</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">      <span class="kw">let</span> slice <span class="op">=</span> <span class="va">buffer</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> i)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">      <span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`slice(0, </span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dv">23</span><span class="op">,</span> <span class="st">&#39;_&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">      <span class="va">logging</span>.<span class="at">log</span>(slice)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40">      <span class="va">logging</span>.<span class="at">log</span>(<span class="vs">`Decoded slice: </span><span class="sc">${</span><span class="va">decoder</span>.<span class="at">decode</span>(slice)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42">  <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">    <span class="cf">if</span> (e <span class="kw">instanceof</span> TypeError <span class="op">&amp;&amp;</span> <span class="va">e</span>.<span class="at">code</span> <span class="op">===</span> <span class="st">&#39;ERR_ENCODING_INVALID_ENCODED_DATA&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">      <span class="co">// Output expected ERR_ENCODING_INVALID_ENCODED_DATA TypeErrors.</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45">      <span class="va">logging</span>.<span class="at">log</span>(e)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47">      <span class="co">// Output unexpected Errors.</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48">      <span class="va">logging</span>.<span class="at">log</span>(e<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50">  <span class="op">}</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="op">}</span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="at">executeTests</span>()<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">// logging module - index.js</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">const</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;fs&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">const</span> SeparatorCharacterDefault <span class="op">=</span> <span class="st">&#39;-&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">const</span> SeparatorLengthDefault <span class="op">=</span> <span class="dv">40</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">   * Outputs a line separator via console.log, with optional first argument text centered in the middle.</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">   */</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">lineSeparator</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    <span class="co">// Check if at least one argument of string type is passed.</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">    <span class="cf">if</span> (<span class="va">arguments</span>.<span class="at">length</span> <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> <span class="kw">typeof</span>(arguments[<span class="dv">0</span>]) <span class="op">===</span> <span class="st">&#39;string&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">      <span class="at">lineSeparatorWithInsert</span>(arguments[<span class="dv">0</span>]<span class="op">,</span> arguments[<span class="dv">1</span>]<span class="op">,</span> arguments[<span class="dv">2</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">      <span class="co">// Otherwise, assume default separator without insertion.</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">      <span class="at">lineSeparator</span>(arguments[<span class="dv">0</span>]<span class="op">,</span> arguments[<span class="dv">1</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">   * Log the passed object or value.</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">   *</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="cv">value</span><span class="co"> Value to be logged to the console.</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">   */</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25">  <span class="dt">log</span><span class="op">:</span> <span class="kw">function</span> (value) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">    <span class="cf">if</span> (value <span class="kw">instanceof</span> Error) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27">      <span class="at">logError</span>(value<span class="op">,</span> arguments[<span class="dv">1</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29">      <span class="at">logValue</span>(value)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"></a>
<a class="sourceLine" id="cb2-33" data-line-number="33">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">   * Synchronously log the passed object or value.</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">   *</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="cv">value</span><span class="co"> Value to be logged to the console.</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">   */</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38">  <span class="dt">logSync</span><span class="op">:</span> <span class="kw">function</span> (value) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39">    <span class="cf">if</span> (value <span class="kw">instanceof</span> Error) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40">      <span class="at">logError</span>(value<span class="op">,</span> arguments[<span class="dv">1</span>]<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42">      <span class="at">logValue</span>(value<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="op">};</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="co">/**</span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48"><span class="co"> * Outputs a line separator via console.log.</span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-50" data-line-number="50"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">length</span><span class="co"> Total separator length.</span></a>
<a class="sourceLine" id="cb2-51" data-line-number="51"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">char</span><span class="co"> Separator character.</span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52"><span class="co"> */</span></a>
<a class="sourceLine" id="cb2-53" data-line-number="53"><span class="kw">function</span> <span class="at">lineSeparator</span> (length <span class="op">=</span> SeparatorLengthDefault<span class="op">,</span> char <span class="op">=</span> SeparatorCharacterDefault) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-54" data-line-number="54">  <span class="co">// Default output to insertion.</span></a>
<a class="sourceLine" id="cb2-55" data-line-number="55">  <span class="at">logValue</span>(<span class="at">Array</span>(length).<span class="at">join</span>(char))<span class="op">;</span></a>
<a class="sourceLine" id="cb2-56" data-line-number="56"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-57" data-line-number="57"></a>
<a class="sourceLine" id="cb2-58" data-line-number="58"><span class="co">/**</span></a>
<a class="sourceLine" id="cb2-59" data-line-number="59"><span class="co"> * Outputs a line separator via console.log with inserted text centered in the middle.</span></a>
<a class="sourceLine" id="cb2-60" data-line-number="60"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-61" data-line-number="61"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">insert</span><span class="co"> Inserted text to be centered.</span></a>
<a class="sourceLine" id="cb2-62" data-line-number="62"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">length</span><span class="co"> Total separator length.</span></a>
<a class="sourceLine" id="cb2-63" data-line-number="63"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">char</span><span class="co"> Separator character.</span></a>
<a class="sourceLine" id="cb2-64" data-line-number="64"><span class="co"> */</span></a>
<a class="sourceLine" id="cb2-65" data-line-number="65"><span class="kw">function</span> <span class="at">lineSeparatorWithInsert</span> (insert<span class="op">,</span> length <span class="op">=</span> SeparatorLengthDefault<span class="op">,</span> char <span class="op">=</span> SeparatorCharacterDefault) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-66" data-line-number="66">  <span class="co">// Default output to insertion.</span></a>
<a class="sourceLine" id="cb2-67" data-line-number="67">  <span class="kw">let</span> output <span class="op">=</span> insert<span class="op">;</span></a>
<a class="sourceLine" id="cb2-68" data-line-number="68"></a>
<a class="sourceLine" id="cb2-69" data-line-number="69">  <span class="cf">if</span> (<span class="va">insert</span>.<span class="at">length</span> <span class="op">&lt;</span> length) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-70" data-line-number="70">    <span class="co">// Update length based on insert length, less a space for margin.</span></a>
<a class="sourceLine" id="cb2-71" data-line-number="71">    length <span class="op">-=</span> <span class="va">insert</span>.<span class="at">length</span> <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-72" data-line-number="72">    <span class="co">// Halve the length and floor left side.</span></a>
<a class="sourceLine" id="cb2-73" data-line-number="73">    <span class="kw">let</span> left <span class="op">=</span> <span class="va">Math</span>.<span class="at">floor</span>(length / <span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-74" data-line-number="74">    <span class="kw">let</span> right <span class="op">=</span> left<span class="op">;</span></a>
<a class="sourceLine" id="cb2-75" data-line-number="75">    <span class="co">// If odd number, add dropped remainder to right side.</span></a>
<a class="sourceLine" id="cb2-76" data-line-number="76">    <span class="cf">if</span> ((length <span class="op">%</span> <span class="dv">2</span>) <span class="op">!==</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-77" data-line-number="77">      right <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-78" data-line-number="78">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-79" data-line-number="79"></a>
<a class="sourceLine" id="cb2-80" data-line-number="80">    <span class="co">// Surround insert with separators.</span></a>
<a class="sourceLine" id="cb2-81" data-line-number="81">    output <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="at">Array</span>(left).<span class="at">join</span>(char)<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insert<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="at">Array</span>(right).<span class="at">join</span>(char)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-82" data-line-number="82">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-83" data-line-number="83"></a>
<a class="sourceLine" id="cb2-84" data-line-number="84">  <span class="at">logValue</span>(output)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-85" data-line-number="85"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-86" data-line-number="86"></a>
<a class="sourceLine" id="cb2-87" data-line-number="87"><span class="co">/**</span></a>
<a class="sourceLine" id="cb2-88" data-line-number="88"><span class="co"> * Logs an Error with explicit/inexplicit tag, error name, and message.</span></a>
<a class="sourceLine" id="cb2-89" data-line-number="89"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-90" data-line-number="90"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">error</span><span class="co"> Error to be logged.</span></a>
<a class="sourceLine" id="cb2-91" data-line-number="91"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">explicit</span><span class="co"> Determines if passed Error was explicit (intended) or not.</span></a>
<a class="sourceLine" id="cb2-92" data-line-number="92"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">synchronous</span><span class="co"> Determines if output must be synchronous.</span></a>
<a class="sourceLine" id="cb2-93" data-line-number="93"><span class="co"> */</span></a>
<a class="sourceLine" id="cb2-94" data-line-number="94"><span class="kw">function</span> <span class="at">logError</span>(error<span class="op">,</span> explicit <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> synchronous <span class="op">=</span> <span class="kw">false</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-95" data-line-number="95">  <span class="kw">let</span> message <span class="op">=</span> <span class="vs">`[</span><span class="sc">${</span>explicit <span class="op">?</span> <span class="st">&#39;EXPLICIT&#39;</span> : <span class="st">&#39;INEXPLICIT&#39;</span><span class="sc">}</span><span class="vs">] </span><span class="sc">${</span><span class="va">error</span>.<span class="at">name</span><span class="sc">}</span><span class="vs">: </span><span class="sc">${</span><span class="va">error</span>.<span class="at">message</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-96" data-line-number="96">  <span class="co">// To avoid duplication get stack without initial error message line.</span></a>
<a class="sourceLine" id="cb2-97" data-line-number="97">  <span class="kw">let</span> stack <span class="op">=</span> <span class="va">error</span>.<span class="va">stack</span>.<span class="at">slice</span>(<span class="va">error</span>.<span class="va">stack</span>.<span class="at">indexOf</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-98" data-line-number="98">  <span class="co">// Use fs.writeSync for synchronous output, otherwise console.log.</span></a>
<a class="sourceLine" id="cb2-99" data-line-number="99">  <span class="cf">if</span> (synchronous) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-100" data-line-number="100">    <span class="va">fs</span>.<span class="at">writeSync</span>(<span class="dv">1</span><span class="op">,</span> message <span class="op">+</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-101" data-line-number="101">    <span class="va">fs</span>.<span class="at">writeSync</span>(<span class="dv">1</span><span class="op">,</span> stack)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-102" data-line-number="102">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-103" data-line-number="103">    <span class="va">console</span>.<span class="at">log</span>(message)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-104" data-line-number="104">    <span class="va">console</span>.<span class="at">log</span>(stack)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-105" data-line-number="105">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-106" data-line-number="106"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-107" data-line-number="107"></a>
<a class="sourceLine" id="cb2-108" data-line-number="108"><span class="co">/**</span></a>
<a class="sourceLine" id="cb2-109" data-line-number="109"><span class="co"> * Logs a value (string, object, number, etc).</span></a>
<a class="sourceLine" id="cb2-110" data-line-number="110"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-111" data-line-number="111"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">value</span><span class="co"> Value to be logged.</span></a>
<a class="sourceLine" id="cb2-112" data-line-number="112"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">synchronous</span><span class="co"> Determines if output must be synchronous.</span></a>
<a class="sourceLine" id="cb2-113" data-line-number="113"><span class="co"> */</span></a>
<a class="sourceLine" id="cb2-114" data-line-number="114"><span class="kw">function</span> <span class="at">logValue</span>(value<span class="op">,</span> synchronous <span class="op">=</span> <span class="kw">false</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-115" data-line-number="115">  <span class="co">// Use fs.writeSync for synchronous output, otherwise console.log.</span></a>
<a class="sourceLine" id="cb2-116" data-line-number="116">  <span class="cf">if</span> (synchronous) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-117" data-line-number="117">    <span class="va">fs</span>.<span class="at">writeSync</span>(<span class="dv">1</span><span class="op">,</span> value <span class="op">+</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-118" data-line-number="118">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-119" data-line-number="119">    <span class="va">console</span>.<span class="at">log</span>(value)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-120" data-line-number="120">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-121" data-line-number="121"><span class="op">}</span></a></code></pre></div>
<h2 id="when-should-you-use-it">When Should You Use It?</h2>
<p>Since the <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> error indicates a problem with the <code>TextDecoder</code> module we’ll start our code sample by creating a simple wrapper function designed to decode a <code>Buffer</code> object using <code>TextDecoder</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">/**</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"> * Decodes passed Buffer via TextDecoder, using passed encoding and fatal option.</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co"> * Iterates and outputs each byte segment of full buffer.</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"> *</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">buffer</span><span class="co"> Buffer to be decoded.</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">encoding</span><span class="co"> Encoding to use.</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">fatal</span><span class="co"> Determines if decoder will throw errors if an issue occurs.</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"> */</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">function</span> <span class="at">decodeBuffer</span> (buffer<span class="op">,</span> encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span><span class="op">,</span> fatal<span class="op">=</span><span class="kw">true</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="co">// Create text decoder with proper encoding and fatal option.</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    <span class="kw">const</span> decoder <span class="op">=</span> <span class="kw">new</span> <span class="at">TextDecoder</span>(encoding<span class="op">,</span> <span class="op">{</span> <span class="dt">fatal</span><span class="op">:</span> fatal <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="co">// Iterate through buffer, slicing from start to each index, then outputting and decoding.</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="va">buffer</span>.<span class="at">length</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">--</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">      <span class="kw">let</span> slice <span class="op">=</span> <span class="va">buffer</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> i)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">      <span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`slice(0, </span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dv">23</span><span class="op">,</span> <span class="st">&#39;_&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">      <span class="va">logging</span>.<span class="at">log</span>(slice)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">      <span class="va">logging</span>.<span class="at">log</span>(<span class="vs">`Decoded slice: </span><span class="sc">${</span><span class="va">decoder</span>.<span class="at">decode</span>(slice)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">  <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">    <span class="cf">if</span> (e <span class="kw">instanceof</span> TypeError <span class="op">&amp;&amp;</span> <span class="va">e</span>.<span class="at">code</span> <span class="op">===</span> <span class="st">&#39;ERR_ENCODING_INVALID_ENCODED_DATA&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24">      <span class="co">// Output expected ERR_ENCODING_INVALID_ENCODED_DATA TypeErrors.</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">      <span class="va">logging</span>.<span class="at">log</span>(e)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">      <span class="co">// Output unexpected Errors.</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28">      <span class="va">logging</span>.<span class="at">log</span>(e<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="op">}</span></a></code></pre></div>
<p>This function instantiates a <code>TextDecoder</code> object using the passed <code>encoding</code> and <code>fatal</code> parameters, then iterates through and outputs each chunk of the passed <code>buffer</code> before passing it to our <code>decoder</code> instance. This iteration will be important in a moment, but for now it just allows us to see the full byte composition each individual slice of our buffer, and how each of those corresponds to the string characters in the buffer.</p>
<p>We’ll start our tests by creating a <code>Buffer</code> from a string of <code>'Airbrake.io'</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`DECODE: Airbrake.io`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>(<span class="st">&#39;Airbrake.io&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>This test produces the following output:</p>
<pre><code>====================================== DECODE: Airbrake.io =======================================
___ slice(0, 11) ____
&lt;Buffer 41 69 72 62 72 61 6b 65 2e 69 6f&gt;
Decoded slice: Airbrake.io
___ slice(0, 10) ____
&lt;Buffer 41 69 72 62 72 61 6b 65 2e 69&gt;
Decoded slice: Airbrake.i
____ slice(0, 9) ____
&lt;Buffer 41 69 72 62 72 61 6b 65 2e&gt;
Decoded slice: Airbrake.
____ slice(0, 8) ____
&lt;Buffer 41 69 72 62 72 61 6b 65&gt;
Decoded slice: Airbrake
____ slice(0, 7) ____
&lt;Buffer 41 69 72 62 72 61 6b&gt;
Decoded slice: Airbrak
____ slice(0, 6) ____
&lt;Buffer 41 69 72 62 72 61&gt;
Decoded slice: Airbra
____ slice(0, 5) ____
&lt;Buffer 41 69 72 62 72&gt;
Decoded slice: Airbr
____ slice(0, 4) ____
&lt;Buffer 41 69 72 62&gt;
Decoded slice: Airb
____ slice(0, 3) ____
&lt;Buffer 41 69 72&gt;
Decoded slice: Air
____ slice(0, 2) ____
&lt;Buffer 41 69&gt;
Decoded slice: Ai
____ slice(0, 1) ____
&lt;Buffer 41&gt;
Decoded slice: A</code></pre>
<p>Cool! We can see each iteration outputs the <code>slice(...)</code> values it is using, along with the <code>Buffer</code> byte array of that slice, and finally the decoded string of that slice. We’re using <code>utf-8</code> encoding, so these basic characters aren’t likely to give us much trouble. However, let’s make a slight alteration by changing the <code>A</code> in our string to a special <code>Â</code> character:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`DECODE: Âirbrake.io`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>(<span class="st">&#39;Âirbrake.io&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>Everything else is the same as before, except that first character, so let’s look at the test output:</p>
<pre><code>====================================== DECODE: Âirbrake.io =======================================
___ slice(0, 12) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e 69 6f&gt;
Decoded slice: Âirbrake.io
___ slice(0, 11) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e 69&gt;
Decoded slice: Âirbrake.i
___ slice(0, 10) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e&gt;
Decoded slice: Âirbrake.
____ slice(0, 9) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65&gt;
Decoded slice: Âirbrake
____ slice(0, 8) ____
&lt;Buffer c3 82 69 72 62 72 61 6b&gt;
Decoded slice: Âirbrak
____ slice(0, 7) ____
&lt;Buffer c3 82 69 72 62 72 61&gt;
Decoded slice: Âirbra
____ slice(0, 6) ____
&lt;Buffer c3 82 69 72 62 72&gt;
Decoded slice: Âirbr
____ slice(0, 5) ____
&lt;Buffer c3 82 69 72 62&gt;
Decoded slice: Âirb
____ slice(0, 4) ____
&lt;Buffer c3 82 69 72&gt;
Decoded slice: Âir
____ slice(0, 3) ____
&lt;Buffer c3 82 69&gt;
Decoded slice: Âi
____ slice(0, 2) ____
&lt;Buffer c3 82&gt;
Decoded slice: Â
____ slice(0, 1) ____
&lt;Buffer c3&gt;
[EXPLICIT] TypeError [ERR_ENCODING_INVALID_ENCODED_DATA]: The encoded data was not valid for encoding utf-8
    at TextDecoder.decode (internal/encoding.js:390:21)
    at decodeBuffer (D:\work\Airbrake.io\Exceptions\NodeJS\Error\SystemError\ERR_ENCODING_INVALID_ENCODED_DATA\index.js:40:45)
    at executeTests (D:\work\Airbrake.io\Exceptions\NodeJS\Error\SystemError\ERR_ENCODING_INVALID_ENCODED_DATA\index.js:12:3)
    at Object.&lt;anonymous&gt; (D:\work\Airbrake.io\Exceptions\NodeJS\Error\SystemError\ERR_ENCODING_INVALID_ENCODED_DATA\index.js:53:1)
    at Module._compile (module.js:657:14)
    at Object.Module._extensions..js (module.js:671:10)
    at Module.load (module.js:573:32)
    at tryModuleLoad (module.js:513:12)
    at Function.Module._load (module.js:505:3)
    at Function.Module.runMain (module.js:701:10)</code></pre>
<p>This time we caught an <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> error that indicates the encoded data was invalid with the <code>utf-8</code> encoding we’re using. What’s critical to note is <em>where</em> in our iteration this error was thrown. Everything was working just fine until we reached the <code>slice(0, 1)</code> byte, which we can see from the <code>Buffer</code> output is equal to the octal <code>0xc3</code>. However, the <em>previous</em> iteration where our <code>Buffer</code> slice contained two octals of <code>0xc3</code> and <code>0x82</code> worked just fine. This is because the combination of those two bytes (i.e. the <code>hexadecimal</code> representation) is how the <a href="http://www.fileformat.info/info/unicode/char/00c2/index.htm">unicode</a> of our special <code>Â</code> character is defined. But, the singular <code>0xc3</code> byte/hex <em>is not</em> representative of any unicode character in <code>utf-8</code>, which is why the final <code>Buffer</code> slice produces the <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> error.</p>
<p>To further illustrate we can actually create a <code>Buffer</code> from an array of octals. Here we’re performing the exact same test as before, except we’re representing the <code>Âirbrake.io</code> string in its octal/hexadecimal format:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`DECODE: [0xc3, 0x82, 0x69, 0x72, 0x62, 0x72, 0x61, 0x6b, 0x65, 0x2e, 0x69, 0x6f]`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>([<span class="bn">0xc3</span><span class="op">,</span> <span class="bn">0x82</span><span class="op">,</span> <span class="bn">0x69</span><span class="op">,</span> <span class="bn">0x72</span><span class="op">,</span> <span class="bn">0x62</span><span class="op">,</span> <span class="bn">0x72</span><span class="op">,</span> <span class="bn">0x61</span><span class="op">,</span> <span class="bn">0x6b</span><span class="op">,</span> <span class="bn">0x65</span><span class="op">,</span> <span class="bn">0x2e</span><span class="op">,</span> <span class="bn">0x69</span><span class="op">,</span> <span class="bn">0x6f</span>]))<span class="op">;</span></a></code></pre></div>
<p>Once again, the output is the same as our previous test, with an <code>ERR_ENCODING_INVALID_ENCODED_DATA</code> error while trying to decode the final (invalid) slice:</p>
<pre><code>======== DECODE: [0xc3, 0x82, 0x69, 0x72, 0x62, 0x72, 0x61, 0x6b, 0x65, 0x2e, 0x69, 0x6f] ========
___ slice(0, 12) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e 69 6f&gt;
Decoded slice: Âirbrake.io
___ slice(0, 11) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e 69&gt;
Decoded slice: Âirbrake.i
___ slice(0, 10) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e&gt;
Decoded slice: Âirbrake.
____ slice(0, 9) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65&gt;
Decoded slice: Âirbrake
____ slice(0, 8) ____
&lt;Buffer c3 82 69 72 62 72 61 6b&gt;
Decoded slice: Âirbrak
____ slice(0, 7) ____
&lt;Buffer c3 82 69 72 62 72 61&gt;
Decoded slice: Âirbra
____ slice(0, 6) ____
&lt;Buffer c3 82 69 72 62 72&gt;
Decoded slice: Âirbr
____ slice(0, 5) ____
&lt;Buffer c3 82 69 72 62&gt;
Decoded slice: Âirb
____ slice(0, 4) ____
&lt;Buffer c3 82 69 72&gt;
Decoded slice: Âir
____ slice(0, 3) ____
&lt;Buffer c3 82 69&gt;
Decoded slice: Âi
____ slice(0, 2) ____
&lt;Buffer c3 82&gt;
Decoded slice: Â
____ slice(0, 1) ____
&lt;Buffer c3&gt;
[EXPLICIT] TypeError [ERR_ENCODING_INVALID_ENCODED_DATA]: The encoded data was not valid for encoding utf-8
    at TextDecoder.decode (internal/encoding.js:390:21)
    at decodeBuffer (D:\work\Airbrake.io\Exceptions\NodeJS\Error\SystemError\ERR_ENCODING_INVALID_ENCODED_DATA\index.js:40:45)
    at executeTests (D:\work\Airbrake.io\Exceptions\NodeJS\Error\SystemError\ERR_ENCODING_INVALID_ENCODED_DATA\index.js:15:3)
    at Object.&lt;anonymous&gt; (D:\work\Airbrake.io\Exceptions\NodeJS\Error\SystemError\ERR_ENCODING_INVALID_ENCODED_DATA\index.js:53:1)
    at Module._compile (module.js:657:14)
    at Object.Module._extensions..js (module.js:671:10)
    at Module.load (module.js:573:32)
    at tryModuleLoad (module.js:513:12)
    at Function.Module._load (module.js:505:3)
    at Function.Module.runMain (module.js:701:10)</code></pre>
<p>Keen observers may have noticed our internal call to the <code>TextDecoder</code> constructor passed a special <code>{ fatal: fatal }</code> argument. Our default value for this argument is <code>true</code>, but let’s try one more test with our special character string, but where we set this <code>fatal</code> argument to <code>false</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="va">logging</span>.<span class="at">lineSeparator</span>(<span class="vs">`NON-FATALLY DECODE: Âirbrake.io`</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="st">&#39;=&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="at">decodeBuffer</span>(<span class="va">Buffer</span>.<span class="at">from</span>(<span class="st">&#39;Âirbrake.io&#39;</span>)<span class="op">,</span> <span class="st">&#39;utf-8&#39;</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
<p>We’ll skip most of the iteration output this time since nothing has changed, but one major difference is immediately noticeable: There’s no error thrown during the final slice decoding.</p>
<pre><code>================================ NON-FATALLY DECODE: Âirbrake.io =================================
___ slice(0, 12) ____
&lt;Buffer c3 82 69 72 62 72 61 6b 65 2e 69 6f&gt;
Decoded slice: Âirbrake.io

...

____ slice(0, 2) ____
&lt;Buffer c3 82&gt;
Decoded slice: Â
____ slice(0, 1) ____
&lt;Buffer c3&gt;
Decoded slice: �</code></pre>
<p>My particular console produces the <code>�</code> character when it’s trying to output something that cannot be rendered, but we can see that no error was thrown <em>because</em> the <code>fatal</code> option of the <code>TextDecoder</code> was set to <code>false</code>. This is handy for when you want to decode something, but you don’t care if the input is actually totally valid for the particular encoding you’re using.</p>
<p>Airbrake’s robust <a class="js-cta-utm" href="https://airbrake.io/account/new?utm_source=blog&utm_medium=end-post&utm_campaign=airbrake-nodejs-error-handling">error monitoring software</a> provides real-time error monitoring and automatic error reporting for all your development projects. Airbrake’s state of the art web dashboard ensures you receive round-the-clock status updates on your application’s health and error rates. No matter what you’re working on, Airbrake easily integrates with all the most popular languages and frameworks. Plus, Airbrake makes it easy to customize error parameters, while giving you complete control of the active error filter system, so you only gather the errors that matter most.</p>
<p>Check out <a class="js-cta-utm" href="https://airbrake.io/account/new?utm_source=blog&utm_medium=end-post&utm_campaign=airbrake-nodejs-error-handling">Airbrake’s error monitoring software</a> today and see for yourself why so many of the world’s best engineering teams use Airbrake to revolutionize their exception handling practices!</p>
